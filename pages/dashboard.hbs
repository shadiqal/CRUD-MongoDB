<!DOCTYPE html>
<html>

<head>
    <title>sadwa</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.7.6/css/mdb.min.css" rel="stylesheet">
</head>

<body onload="init()">

    <!--Navbar -->
    <nav class="mb-1 navbar navbar-expand-lg navbar-dark default-color">
        <a class="navbar-brand" href="#">Navbar</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent-333"
            aria-controls="navbarSupportedContent-333" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent-333">
            <ul class="navbar-nav mr-auto">
            </ul>
            <ul class="navbar-nav ml-auto nav-flex-icons">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-333" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-user"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right dropdown-default"
                        aria-labelledby="navbarDropdownMenuLink-333">
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav><br>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="card">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item active">Data master</li>
                    </ul>
                </div>
                <br>
            </div>
            <div class="col-md-9">
                <div class="card">
                    <div class="card-header">
                        Data master
                    </div>
                    <div class="card-body">
                        <h6 class="card-title">
                            <a href="" style="color: gray" data-toggle="modal" data-target="#modalRegisterForm">
                                <i class="fas fa-plus"></i>
                                <strong>Tambah data</strong>
                            </a>
                            |
                            <a href="" style="color: gray">
                                <i class="fas fa-print"></i>
                                <strong>Print</strong>
                            </a>
                        </h6>
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">Nama barang</th>
                                    <th scope="col">tag</th>
                                    <th scope="col">Tanggal input</th>
                                </tr>
                            </thead>
                            <tbody>
                                <div id="barang">

                                </div>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--/.Navbar -->
    <br>

    <div class="modal fade" id="modalRegisterForm" tabindex="-1" role="dialog" aria-labelledby="modalRegisterForm"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Tambah data</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="tambahData">
                    <div class="modal-body mx-3">
                        <div class="md-form mb-5">
                            <p class=""><i class="fas fa-toolbox  grey-text"></i> Nama Barang</p>
                            <input type="text" id="namaBarang" class="form-control validate">
                        </div>
                        <div class="md-form mb-5">
                            <p class=""><i class="fas fa-tags  grey-text"></i> Tags</p>
                            <input type="text" id="tag" class="form-control validate">
                        </div>
                        <div class="md-form mb-5">
                            <p class=""><i class="fas fa-calendar  grey-text"></i> Tanggal</p>
                            <input type="text" id="tanggal" class="form-control validate">
                        </div>


                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <button class="btn btn-deep-orange">Tambah</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editForm" tabindex="-1" role="dialog" aria-labelledby="editForm" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Edit Data</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="update">
                    <div class="modal-body mx-3">
                        <input type="hidden" id="id" value="">
                        <div class="md-form mb-5">
                            <p class=""><i class="fas fa-toolbox  grey-text"></i> Nama Barang</p>
                            <input type="text" id="editNamaBarang" value="" class="form-control validate">
                        </div>
                        <div class="md-form mb-5">
                            <p class=""><i class="fas fa-tags  grey-text"></i> Tags</p>
                            <input type="text" id="editTag" value="" class="form-control validate">
                        </div>
                        <div class="md-form mb-5">
                            <p class=""><i class="fas fa-calendar grey-text"></i> Tanggal</p>
                            <input type="text" id="editTanggal" value="" class="form-control validate">
                        </div>


                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <button class="btn btn-deep-orange">Ubah</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JQuery -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script>
        function init() {
            $.ajax({
                url: '/dashboard/master/fetch',
                method: 'GET'
            }).done(function (data) {
                var output;
                for (var i in data) {
                    output += '<tr><td>' + data[i].namaBarang + '</td>' +
                        '<td>' + data[i].tag + '</td>' +
                        '<td>' + data[i].tanggal + '</td>' +
                        '<td><div class="btn btn-sm btn-info"><a data-toggle="modal" data-target="#editForm" onclick="formEdit(\'' + data[i]._id + '\')">Edit</a></div>' +
                        '<a onclick="hapus(\'' + data[i]._id + '\')"><div class="btn btn-sm btn-danger"><i class="fas fa-trash-alt"></i></div></a></td></tr>';
                }
                $('table tbody').html(output);
            })
        }
        $('form#tambahData').submit(function (e) {
            e.preventDefault();
            var namaBarang = $('#namaBarang').val();
            var tag = $('#tag').val();
            var tanggal = $('#tanggal').val();
            $.ajax({
                url: '/dashboard/master/tambahData',
                method: 'POST',
                data: {
                    namaBarang: namaBarang,
                    tag: tag,
                    tanggal: tanggal
                }
            }).done(function (data) {
                if (data.success == true) {
                    init()
                } else {

                }
            })
        })
        function formEdit(id) {
            console.log(id)
            $.ajax({
                url: '/dashboard/master/formEdit',
                method: 'POST',
                data: { id: id }
            }).done(function (data) {
                $('#editNamaBarang').val(data[0].namaBarang);
                $('#editTag').val(data[0].tag);
                $('#editTanggal').val(data[0].tanggal);

                $('#id').val(id);
            });
        }
        function hapus(id) {
            console.log(id)
            $.ajax({
                url: '/dashboard/master/delete',
                method: 'DELETE',
                data: { id: id }
            }).done(function (data) {
                console.log(data)
                if (data.success == true) {
                    init()
                }
            })
        }
        $('form#update').submit(function (e) {
            e.preventDefault();
            var namaBarang = $('#editNamaBarang').val();
            var tag = $('#editTag').val();
            var tanggal = $('#editTanggal').val();
            console.log(tanggal)
            var id = $('#id').val();
            $.ajax({
                url: '/dashboard/master/update',
                method: 'POST',
                data: {
                    namaBarang: namaBarang,
                    tag: tag,
                    tanggal: tanggal,
                    id: id
                }
            }).done(function (data) {
                console.log(data)
                if (data.success == true) {
                    init()
                }
            })
        })

    </script>

</body>


</html>